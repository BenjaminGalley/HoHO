<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fast Keno | HoHoHo Bet</title>
<link rel="stylesheet" href="style.css">
<style>
body{margin:0;padding:0;font-family:sans-serif;background:#ffeedd;color:#000;overflow-x:hidden}
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#223311;border-bottom:3px solid #ffcc33;color:#fff}
.logo-container{display:flex;align-items:center;gap:10px}
.logo-container img{height:50px;border-radius:10px}
.balance-panel{margin:10px;font-weight:bold;font-size:18px}
.main-content{padding:20px;text-align:center}
.keno-header{font-size:28px;font-weight:bold;color:#ffcc33;margin-bottom:15px;text-shadow:1px 1px 2px #000}
.keno-table{display:grid;grid-template-columns:repeat(10,1fr);grid-gap:5px;margin:auto;width:90%;border:3px solid #ffcc33;background:#cc0000;padding:10px;border-radius:10px}
.keno-number{width:100%;padding-top:100%;position:relative;background:#ff4444;border:1px solid #ffd700;border-radius:5px;cursor:pointer;transition:0.2s}
.keno-number span{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:bold;color:#fff;font-size:14px}
.keno-number.selected{background:#ffcc33;color:#000;font-weight:bold}
.bet-panel{margin-top:10px;display:flex;justify-content:center;align-items:center;gap:10px}
.bet-panel button{padding:5px 12px;font-weight:bold;border-radius:5px;border:none;cursor:pointer;background:#223311;color:#fff;transition:0.2s}
.bet-panel button:hover{background:#ffcc33;color:#000}
.ticket-board{margin-top:15px;display:flex;overflow-x:auto;gap:10px;padding:5px}
.ticket{background:#111;color:#ffcc33;padding:10px;border-radius:10px;min-width:180px;white-space:nowrap}
.draw-board{margin-top:15px;font-size:20px;font-weight:bold;display:flex;gap:5px;flex-wrap:wrap;justify-content:center}
.timer{font-size:20px;font-weight:bold;margin:10px;color:#223311}
</style>
</head>
<body>

<div class="top-bar">
  <div class="logo-container">
    <img src="assets/house_logo.png" alt="House Logo">
    <div>HoHoHo Bet</div>
  </div>
  <div class="balance-panel" id="balancePanel"></div>
</div>

<div class="main-content">
  <div class="keno-header">Fast Keno</div>

  <div class="timer" id="roundTimer">Next draw in: 60s</div>

  <div class="keno-table" id="kenoTable"></div>

  <div class="ticket-board" id="ticketBoard"></div>

  <div class="bet-panel">
    <button onclick="decreaseBet()">-</button>
    <span>Bet: <span id="currentBet">2</span> Birr</span>
    <button onclick="increaseBet()">+</button>
    <button onclick="placeBet()">Place Bet</button>
  </div>

  <div class="draw-board" id="drawBoard"></div>
</div>

<script>
let user=JSON.parse(localStorage.getItem("user")||"null");
let balance=Number(localStorage.getItem("balance")||0);
const googleScriptURL="https://script.google.com/macros/s/AKfycbxf_AZ6uJO5BuW9y0M9EuUjF1ZKphqcLG6SeE5DtOORxusuMosjbEvqUiv7tsd4JVfAdA/exec";

document.getElementById("balancePanel").innerText=user?`Balance: ${balance} Birr`:"";

let selectedNumbers=new Set();
let currentBet=2;
const minBet=2,maxNumbers=10;
let ticketCount=0;
const kenoTable=document.getElementById("kenoTable");
const drawBoard=document.getElementById("drawBoard");
const ticketBoard=document.getElementById("ticketBoard");
const roundTimer=document.getElementById("roundTimer");

/* Create 80-number table */
for(let i=1;i<=80;i++){
  const num=document.createElement("div");
  num.className="keno-number";
  const span=document.createElement("span");
  span.innerText=i;
  num.appendChild(span);
  num.onclick=()=>selectNumber(i,num);
  kenoTable.appendChild(num);
}

function selectNumber(number,elem){
  if(selectedNumbers.has(number)){
    selectedNumbers.delete(number);
    elem.classList.remove("selected");
  } else{
    if(selectedNumbers.size>=maxNumbers)return;
    selectedNumbers.add(number);
    elem.classList.add("selected");
  }
  updatePotentialWin();
}

function increaseBet(){currentBet+=2;document.getElementById("currentBet").innerText=currentBet;}
function decreaseBet(){if(currentBet>minBet) currentBet-=2;document.getElementById("currentBet").innerText=currentBet;}

function updatePotentialWin(){
  const potential=selectedNumbers.size>0?currentBet*selectedNumbers.size:0;
  document.getElementById("currentBet").innerText=`${currentBet} (Potential Win: ${potential} Birr)`;
}

function placeBet(){
  if(!user)return alert("Login first");
  if(selectedNumbers.size===0)return alert("Select numbers first");
  if(balance<currentBet)return alert("Insufficient balance");
  balance-=currentBet;
  localStorage.setItem("balance",balance);
  document.getElementById("balancePanel").innerText=`Balance: ${balance} Birr`;

  ticketCount++;
  const ticket=document.createElement("div");
  ticket.className="ticket";
  ticket.innerText=`Ticket #${ticketCount}: [${[...selectedNumbers].join(", ")}] Bet: ${currentBet} Birr`;
  ticketBoard.appendChild(ticket);
  ticketBoard.scrollLeft=ticketBoard.scrollWidth; // scroll to latest

  sendGoogleScript({action:"bet",playerId:user.id,numbers:[...selectedNumbers],amount:currentBet,ticket:ticketCount});

  selectedNumbers.clear();
  Array.from(kenoTable.children).forEach(e=>e.classList.remove("selected"));
  updatePotentialWin();
}

/* Timer and draw */
let roundTime=60;
function startRoundTimer(){
  roundTimer.innerText=`Next draw in: ${roundTime}s`;
  const interval=setInterval(()=>{
    roundTime--;
    if(roundTime<=0){
      clearInterval(interval);
      runDraw();
    }
    roundTimer.innerText=`Next draw in: ${roundTime}s`;
  },1000);
}
startRoundTimer();

function runDraw(){
  drawBoard.innerHTML="";
  const drawNumbers=[];
  while(drawNumbers.length<20){
    let n=Math.floor(Math.random()*80)+1;
    if(!drawNumbers.includes(n))drawNumbers.push(n);
  }

  drawNumbers.forEach((n,i)=>{
    setTimeout(()=>{
      const numElem=document.createElement("div");
      numElem.innerText=n;
      drawBoard.appendChild(numElem);
      markWinningNumbers(n);
    },i*1000);
  });

  setTimeout(()=>{alert("Draw complete!");roundTime=60;startRoundTimer();},drawNumbers.length*1000+5000);
}

function markWinningNumbers(number){
  Array.from(ticketBoard.children).forEach(ticket=>{
    if(ticket.innerText.includes(number)){
      ticket.style.background="#228822";
    }
  });
}

function sendGoogleScript(data){
  fetch(googleScriptURL,{
    method:"POST",
    body:JSON.stringify(data),
    headers:{"Content-Type":"application/json"}
  }).then(r=>r.json()).then(console.log).catch(console.error);
}
</script>

</body>
</html>
